<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>FlightFeedback</title>
		<link type="text/css" rel="stylesheet" href="styles.css"/>
	</head>
	<body>
		<div class="container">
			<h1>HackFlight. Feedback</h1>
			<h2>Search for existing topics</h2>
			<form id="search-form">
				<input type="text" id="search-field" class="form-control" placeholder="Keywords"/>
				<input type="submit" id="search-btn" class="form-control btn" value="Search"/>
			</form>
			<div>Total hits: <span id="hits"></span></div>
			<table id="votes">
				<colgroup>
					<col class="votes-login"/>
					<col class="votes-title"/>
					<col class="votes-text"/>
				</colgroup>
				<tbody></tbody>
			</table>
			<script type="text/javascript" src="scripts.js"></script>
			<script>
				function dosearch() {
					var query = $("#search-field").first().value;
					var $votes = $("#votes tbody").first();
					var $hits = $("#hits").first();
					$votes.innerHTML = null;
					if(query) {
						$.get("/search", {query:query}, function(result) {
							if(result && result.votes) {
								$votes.innerHTML = null;
								$hits.innerHTML = result.hits;
								for(var i = 0; i < result.votes.length; i++) {
									var vote = result.votes[i];
									$votes.innerHTML += "<tr><td>" + vote.login + "</td><td>" + vote.title + "</td><td>" + vote.text + "</td></tr>";
								}
							}
						});
					}
				}
				$("#search-form").first().onsubmit = function(e) {
					e.preventDefault();
					dosearch();
				}
				dosearch();
			</script>
		</div>
	</body>
</html>